{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Petitions</h2>
    <a class="btn btn-sm btn-primary" href="{% url 'movies.petitions_new' %}">New Petition</a>
  </div>

  <ul class="list-group">
    {% for p in template_data.petitions %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ p.movie_title }}</strong>
          {% if p.details %}<div class="text-muted small">{{ p.details|truncatechars:140 }}</div>{% endif %}
          <div class="small text-muted">by {{ p.requested_by.username }} Â· {{ p.created|date:"Y-m-d H:i" }}</div>
        </div>
        <div class="d-flex align-items-center gap-3">
          <span class="badge bg-success">Yes: {{ p.yes_count }}</span>
          {% if user.is_authenticated %}
          <form method="post" action="{% url 'movies.petitions_vote' petition_id=p.id %}">
            {% csrf_token %}
            <button class="btn btn-sm btn-outline-success" type="submit">Vote Yes</button>
          </form>
          {% else %}
            <small class="text-muted">Log in to vote</small>
          {% endif %}
        </div>
      </li>
    {% empty %}
      <li class="list-group-item">No petitions yet.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
